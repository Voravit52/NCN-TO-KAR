# แปลงคาราโอเกะNCNเป็นKAR

สคริปต์นี้ใช้ในการแปลงไฟล์ Karaoke NCN (.mid, .lyr, .cur) ให้เป็นไฟล์ .kar โดยทำการรวมไฟล์ MIDI ที่มีทำนองเพลงเข้ากับเนื้อเพลงและข้อมูลเวลา เพื่อสร้างไฟล์ Karaoke ที่สามารถใช้งานได้กับซอฟต์แวร์คาราโอเกะส่วนใหญ่ที่รองรับไฟล์นามสกุล `.kar`

## ความต้องการ

- Python 3.x
- ไลบรารี `mido` สำหรับการจัดการไฟล์ MIDI

ติดตั้งไลบรารี `mido` โดยใช้คำสั่ง:

```bash
pip install mido
```

## ภาพรวมการทำงาน

สคริปต์นี้ทำงานกับไฟล์ข้อมูล 3 ประเภท:
1. **ไฟล์ MIDI (.mid)** - ไฟล์ทำนองเพลงที่ใช้เป็นพื้นหลัง
2. **ไฟล์เนื้อเพลง (.lyr)** - ไฟล์ข้อความที่ประกอบด้วยชื่อเพลง ศิลปิน และเนื้อเพลง
3. **ไฟล์เวลา (.cur)** - ไฟล์ข้อมูลเวลาที่ใช้ระบุช่วงเวลาในการแสดงเนื้อเพลงแต่ละบรรทัด

## การทำงานของโค้ด

### ฟังก์ชัน `read_lyrics`

ฟังก์ชันนี้ใช้ในการอ่านเนื้อเพลงจากไฟล์ `.lyr` โดยมีขั้นตอนดังนี้:
- อ่านบรรทัดแรกเป็นชื่อเพลง และบรรทัดที่สองเป็นชื่อศิลปิน
- อ่านเนื้อเพลงตั้งแต่บรรทัดที่ 5 เป็นต้นไป และเก็บไว้ในรูปแบบของรายการ (list)

### ฟังก์ชัน `read_cursor`

ฟังก์ชันนี้ใช้ในการอ่านข้อมูลเวลา (timestamp) จากไฟล์ `.cur` โดยมีขั้นตอนดังนี้:
- เปิดไฟล์ `.cur` ในโหมดไบนารี และอ่านข้อมูลทุกๆ 2 ไบต์
- คำนวณเวลาแบบ absolute timestamp และปรับให้เป็นค่า relative timestamp ตาม ticks ต่อ beat ที่กำหนด
- เก็บค่าเวลาที่คำนวณได้ในรูปแบบของรายการ (list)

### ฟังก์ชัน `combine_to_kar`

ฟังก์ชันนี้ทำหน้าที่รวมไฟล์ MIDI เนื้อเพลง และเวลาเพื่อสร้างไฟล์ `.kar` โดยมีขั้นตอนดังนี้:
1. เรียกใช้ฟังก์ชัน `read_lyrics` เพื่อดึงชื่อเพลง ศิลปิน และเนื้อเพลง
2. โหลดไฟล์ MIDI และสร้าง track ใหม่สำหรับการแสดงคาราโอเกะ
3. เพิ่มข้อมูลชื่อเพลงและศิลปินใน track
4. เรียกใช้ฟังก์ชัน `read_cursor` เพื่ออ่านข้อมูลเวลา
5. เพิ่มเนื้อเพลงแต่ละบรรทัดใน track โดยกำหนดเวลาการแสดงตามข้อมูล timestamp
6. บันทึกไฟล์เป็นนามสกุล `.kar`

## วิธีการใช้งาน

1. เตรียมไฟล์ `.mid` (ทำนองเพลง), `.lyr` (เนื้อเพลง), และ `.cur` (ข้อมูลเวลา)
2. ใช้งานฟังก์ชัน `combine_to_kar` โดยระบุชื่อไฟล์ทั้งสาม และระบุชื่อไฟล์ `.kar` ที่ต้องการบันทึก

ตัวอย่างการเรียกใช้งาน:

```python
combine_to_kar("tt.mid", "tt.lyr", "tt.cur", "12345op.kar")
```

หลังจากรันสคริปต์ จะได้ไฟล์ `.kar` ที่สร้างเสร็จในชื่อที่กำหนด
